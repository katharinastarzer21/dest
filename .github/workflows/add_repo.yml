name: Add Repository to Gallery

on:
  issues:
    types: [opened, labeled]

jobs:
  process-request:
    if: contains(github.event.issue.labels.*.name, 'add-repo')
    runs-on: ubuntu-latest

    steps:
    - name: Checkout main repository
      uses: actions/checkout@v3

    - name: Install PyYAML
      run: pip install pyyaml

    - name: Save Issue Body to File
      run: |
        echo "${{ github.event.issue.body }}" > issue_body.txt

    - name: Parse and Update YAML
      run: |
        python3 parse_issue.py

    - name: Clone new Cookbook Repository
      run: |
          git clone $REPO_URL $ROOT_PATH

    - name: Install Sphinx
      run: pip install sphinx myst-parser nbsphinx sphinx-book-theme sphinx-design myst-nb pyyaml ghp-import

    - name: Build HTML from Cookbook (with global conf.py)
      run: |
        sphinx-build -b html $ROOT_PATH _build/html/$ROOT_PATH -c .


    - name: Commit updated YAML and Built HTML
      run: |
        git config --global user.name 'github-actions'
        git config --global user.email 'actions@github.com'
        git add notebook_gallery.yaml
        git add -f _build/html/$ROOT_PATH
        git commit -m "Added new cookbook and built HTML"
        git push -f origin main


